<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>パスワード生成ツール｜安全・無料で使えるオンラインジェネレーター</title>
  <meta name="description" content="シンプルで安全な無料パスワード生成ツール。英字・数字・記号・長さなど自由に設定可能。推定エントロピーや強度メーターも表示。" />
  <link rel="canonical" href="https://1ch1-star1ch1.github.io/password-gen/" />
  <meta property="og:title" content="パスワード生成ツール｜安全・無料で使えるオンラインジェネレーター" />
  <meta property="og:description" content="英字・数字・記号の選択、長さスライダー、曖昧文字除外、先頭英字、重複許可のオプション付き。強度メーター表示＆ワンクリックコピー対応。" />
  <meta property="og:type" content="website" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel (JSX用) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-neutral-50">
  <div class="max-w-3xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-2">パスワード生成ツール</h1>
    <p class="text-sm text-neutral-600">シンプルで実用的。必要なオプションだけ選んで、すぐ生成できます。</p>
  </div>

  <div id="root"></div>

  <!-- アプリ本体（キャンバス版を単一ファイル向けに貼り付け） -->
  <script type="text/babel">
    // ===== ヘルパー＆定数 =====
    const AMBIGUOUS = new Set(["0","O","o","1","l","I","|","S","5","B","8","G","6","2","Z","7","T","+","/","\\"]);
    const CHARSETS = {
      lower: "abcdefghijklmnopqrstuvwxyz",
      upper: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
      number: "0123456789",
      symbol: "!@#$%^&*()-_=+[{]}:;,.?" + "~`" + "<>" + "|/\\'\"",
    };
    const removeAmbiguous = (str)=> [...str].filter(c=>!AMBIGUOUS.has(c)).join("");
    const calculateEntropy = (len, pool)=> (pool<=1||len<=0)?0: len * Math.log2(pool);
    const strengthLabel = (bits)=>{
      if(bits < 40) return {label:"弱い", tier: 0};
      if(bits < 60) return {label:"普通", tier: 1};
      if(bits < 80) return {label:"やや強い", tier: 2};
      if(bits < 100) return {label:"強い", tier: 3};
      return {label:"非常に強い", tier: 4};
    };
    const sampleUnique = (pool, n)=>{
      const arr=[...pool];
      for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];}
      return arr.slice(0,n);
    };
    const randomChoice = (arr)=> arr[Math.floor(Math.random()*arr.length)];

    // ===== React アプリ =====
    function PasswordGenerator(){
      const [length, setLength] = React.useState(16);
      const [useLower, setUseLower] = React.useState(true);
      const [useUpper, setUseUpper] = React.useState(true);
      const [useNumber, setUseNumber] = React.useState(true);
      const [useSymbol, setUseSymbol] = React.useState(false);
      const [excludeAmbiguous, setExcludeAmbiguous] = React.useState(true);
      const [mustStartWithLetter, setMustStartWithLetter] = React.useState(false);
      const [allowRepeat, setAllowRepeat] = React.useState(true);
      const [password, setPassword] = React.useState("");
      const [hidden, setHidden] = React.useState(false);
      const [copied, setCopied] = React.useState(false);

      const pools = React.useMemo(()=>{
        const out=[];
        if(useLower) out.push(CHARSETS.lower);
        if(useUpper) out.push(CHARSETS.upper);
        if(useNumber) out.push(CHARSETS.number);
        if(useSymbol) out.push(CHARSETS.symbol);
        let pool=out.join("");
        if(excludeAmbiguous) pool=removeAmbiguous(pool);
        const poolArr=[...new Set([...pool])];
        return { poolArr, byType: out.map(s=>[...new Set([...(excludeAmbiguous? removeAmbiguous(s) : s)])]) };
      }, [useLower,useUpper,useNumber,useSymbol,excludeAmbiguous]);

      const poolSize = pools.poolArr.length;
      const entropy = calculateEntropy(length, poolSize||1);
      const {label, tier} = strengthLabel(entropy);

      React.useEffect(()=>{ handleGenerate(); }, []);

      function handleGenerate(){
        if(!useLower && !useUpper && !useNumber && !useSymbol){ setPassword(""); return; }
        if(!allowRepeat && length > pools.poolArr.length){
          setPassword("(エラー) 文字数が多すぎます。重複を許可するか、文字種を増やしてください。"); return;
        }
        const mandatorySets = pools.byType;
        let chars=[];

        if(mustStartWithLetter){
          const letterPool=[...(useLower? pools.byType[0]??[]:[]), ...(useUpper? pools.byType[1]??[]:[])];
          if(letterPool.length===0){ setPassword("(エラー) 先頭を英字にするには英字（大/小）を選択してください。"); return; }
          const first = allowRepeat ? randomChoice(letterPool) : sampleUnique(letterPool,1)[0];
          chars.push(first);
        }

        for(const set of mandatorySets){
          if(set.length===0) continue;
          if(mustStartWithLetter && chars.length>0 && set.includes(chars[0]) && (set===mandatorySets[0] || set===mandatorySets[1])){ continue; }
          const ch = allowRepeat ? randomChoice(set) : sampleUnique(set,1)[0];
          chars.push(ch);
        }

        const remaining = length - chars.length;
        const basePool = pools.poolArr;
        if(remaining>0){
          if(allowRepeat){
            for(let i=0;i<remaining;i++) chars.push(randomChoice(basePool));
          }else{
            const used = new Set(chars);
            const avail = basePool.filter(c=>!used.has(c));
            if(avail.length < remaining){ setPassword("(エラー) 文字数が多すぎます。重複を許可するか、文字種を増やしてください。"); return; }
            chars = [...chars, ...sampleUnique(avail, remaining)];
          }
        }

        if(mustStartWithLetter){
          const head=chars[0]; const tail=chars.slice(1);
          for(let i=tail.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [tail[i],tail[j]]=[tail[j],tail[i]];}
          chars=[head, ...tail];
        }else{
          for(let i=chars.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [chars[i],chars[j]]=[chars[j],chars[i]];}
        }

        setPassword(chars.join(""));
        setCopied(false);
      }

      async function handleCopy(){
        if(!password || password.startsWith("(エラー)")){ alert("コピーできる有効なパスワードがありません。"); return; }
        const ta=document.createElement("textarea");
        ta.value=password; document.body.appendChild(ta); ta.select();
        try{ document.execCommand("copy"); setCopied(true); setTimeout(()=>setCopied(false),1500); }
        catch{ setCopied(false); alert("コピーに失敗しました。"); }
        finally{ document.body.removeChild(ta); }
      }

      const meterClasses=["bg-red-500","bg-yellow-500","bg-lime-500","bg-green-500","bg-emerald-600"];

      return (
        <div className="w-full max-w-3xl mx-auto bg-white rounded-2xl shadow-md p-6 md:p-8">
          {/* 入力＆アクション */}
          <div className="flex gap-2 items-center mb-4">
            <input
              type={hidden ? "password" : "text"}
              className="flex-1 rounded-xl border border-neutral-300 px-4 py-3 text-lg font-mono focus:outline-none focus:ring-2 focus:ring-indigo-500"
              value={password}
              onChange={(e)=>setPassword(e.target.value)}
              placeholder="ここに生成結果が表示されます"
              aria-label="生成されたパスワード"
            />
            <button onClick={()=>setHidden(h=>!h)} className="px-3 py-2 rounded-xl border text-sm hover:bg-neutral-50" aria-label="表示切替">
              {hidden? "表示" : "非表示"}
            </button>
            <button onClick={handleCopy} className="px-3 py-2 rounded-xl border text-sm hover:bg-neutral-50" aria-label="コピー">
              {copied? "コピー完了" : "コピー"}
            </button>
          </div>

          {/* 強度メーター */}
          <div className="mb-6">
            <div className="flex justify-between text-xs text-neutral-600 mb-1">
              <span>強度: {label}</span>
              <span>推定エントロピー: {entropy.toFixed(1)} bits</span>
            </div>
            <div className="flex gap-1" aria-hidden>
              {[0,1,2,3,4].map(i=>(
                <div key={i} className={`h-2 flex-1 rounded ${i<=tier? meterClasses[tier]:'bg-neutral-200'}`}/>
              ))}
            </div>
          </div>

          {/* オプション */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div className="p-4 rounded-xl border space-y-4">
              <div>
                <label className="block text-sm font-medium">長さ: <span className="font-mono">{length}</span></label>
                <input type="range" min={4} max={64} value={length} className="w-full"
                       onChange={(e)=>setLength(parseInt(e.target.value))} aria-label="長さスライダー"/>
                <div className="flex justify-between text-xs text-neutral-500"><span>4</span><span>64</span></div>
              </div>

              <div className="grid grid-cols-2 gap-2 text-sm">
                <label className="flex items-center gap-2"><input type="checkbox" checked={useLower} onChange={(e)=>setUseLower(e.target.checked)}/>小文字 a–z</label>
                <label className="flex items-center gap-2"><input type="checkbox" checked={useUpper} onChange={(e)=>setUseUpper(e.target.checked)}/>大文字 A–Z</label>
                <label className="flex items-center gap-2"><input type="checkbox" checked={useNumber} onChange={(e)=>setUseNumber(e.target.checked)}/>数字 0–9</label>
                <label className="flex items-center gap-2"><input type="checkbox" checked={useSymbol} onChange={(e)=>setUseSymbol(e.target.checked)}/>記号 !@#…</label>
              </div>
            </div>

            <div className="p-4 rounded-xl border space-y-3 text-sm">
              <label className="flex items-center gap-2">
                <input type="checkbox" checked={excludeAmbiguous} onChange={(e)=>setExcludeAmbiguous(e.target.checked)}/>
                似ている文字を除外（0/O/1/l/I など）
              </label>
              <label className="flex items-center gap-2">
                <input type="checkbox" checked={mustStartWithLetter} onChange={(e)=>setMustStartWithLetter(e.target.checked)}/>
                先頭は英字にする
              </label>
              <label className="flex items-center gap-2">
                <input type="checkbox" checked={allowRepeat} onChange={(e)=>setAllowRepeat(e.target.checked)}/>
                重複を許可する（同じ文字が複数回出現可）
              </label>
            </div>
          </div>

          <div className="flex gap-2">
            <button onClick={handleGenerate} className="px-4 py-2 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700 active:scale-[.99] transition">生成する</button>
            <button onClick={()=>{setPassword(""); setCopied(false);}} className="px-4 py-2 rounded-xl border hover:bg-neutral-50">クリア</button>
          </div>

          <p className="mt-8 text-xs text-neutral-500">このツールはローカルで完結して動作します（入力は外部送信されません）。</p>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<PasswordGenerator />);
  </script>

  <!-- 楽天アフィリエイト（任意） -->
  <div class="max-w-3xl mx-auto my-8">
    <!-- Rakuten Widget FROM HERE -->
    <script type="text/javascript">
    rakuten_affiliateId="0ea62065.34400275.0ea62066.204f04c0";
    rakuten_items="ctsmatch";
    rakuten_genreId="0";
    rakuten_recommend="on";
    rakuten_design="slide";
    rakuten_size="728x200";
    rakuten_target="_blank";
    rakuten_border="on";
    rakuten_auto_mode="on";
    rakuten_adNetworkId="a8Net";
    rakuten_adNetworkUrl="https%3A%2F%2Frpx.a8.net%2Fsvt%2Fejp%3Fa8mat%3D2I0U4F%2BA4E2A%2B2HOM%2BBS629%26rakuten%3Dy%26a8ejpredirect%3D";
    rakuten_pointbackId="a15120421815_2I0U4F_A4E2A_2HOM_BS629";
    rakuten_mediaId="20011816";
    </script>
    <script type="text/javascript" src="//xml.affiliate.rakuten.co.jp/widget/js/rakuten_widget.js"></script>
    <!-- Rakuten Widget TO HERE -->
    <img border="0" width="1" height="1" src="https://www14.a8.net/0.gif?a8mat=2I0U4F+A4E2A+2HOM+BS629" alt="">
  </div>

  <footer class="max-w-3xl mx-auto text-xs text-neutral-500 p-4">
    <p>© 2025 パスワード生成ツール</p>
  </footer>
</body>
</html>
